<!doctype html>
<html lang="es">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PHHCK23VK6"></script>



  <script>
    // Año
    document.getElementById("year").textContent = new Date().getFullYear();

    // Menú móvil
    const btn = document.getElementById("menuBtn");
    const panel = document.getElementById("mobilePanel");
    function closeMobileMenu(){ panel.style.display="none"; btn.setAttribute("aria-expanded","false"); }
    function toggleMobileMenu(){
      const isOpen = btn.getAttribute("aria-expanded")==="true";
      if(isOpen) closeMobileMenu();
      else{ panel.style.display="block"; btn.setAttribute("aria-expanded","true"); }
    }
    btn.addEventListener("click", toggleMobileMenu);
    panel.querySelectorAll("a").forEach(a=>a.addEventListener("click", closeMobileMenu));
    window.addEventListener("resize", ()=>{ if(window.innerWidth>760) closeMobileMenu(); });

    // Scroll progress
    const progress = document.getElementById("progress");
    function onScroll(){
      const h = document.documentElement;
      const scrolled = (h.scrollTop) / (h.scrollHeight - h.clientHeight);
      progress.style.width = `${Math.max(0, Math.min(1, scrolled)) * 100}%`;
    }
    window.addEventListener("scroll", onScroll, { passive:true });
    onScroll();

    // Smooth anchor
    document.querySelectorAll('a[href^="#"]').forEach(a=>{
      a.addEventListener("click",(e)=>{
        const id = a.getAttribute("href");
        const el = document.querySelector(id);
        if(!el) return;
        e.preventDefault();
        closeMobileMenu();
        const y = el.getBoundingClientRect().top + window.scrollY - 84;
        window.scrollTo({ top:y, behavior:"smooth" });
      });
    });

    // Reveal
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          e.target.classList.add("on");
          io.unobserve(e.target);
        }
      });
    }, { threshold:0.12 });
    document.querySelectorAll(".reveal").forEach(el=>io.observe(el));

    // Modals
    const modals = Array.from(document.querySelectorAll(".modal"));
    let lastFocus = null;
    function openModal(id){
      const modal = document.getElementById(id);
      if(!modal) return;
      lastFocus = document.activeElement;
      modal.classList.add("show");
      document.body.style.overflow="hidden";
      const closeBtn = modal.querySelector(".modal-close");
      if(closeBtn) closeBtn.focus();
    }
    function closeModal(modal){
      modal.classList.remove("show");
      document.body.style.overflow="";
      if(lastFocus && typeof lastFocus.focus==="function") lastFocus.focus();
    }
    function closeAll(){ modals.forEach(m=>m.classList.contains("show") && closeModal(m)); }

    document.addEventListener("click",(e)=>{
      const trigger = e.target.closest("[data-modal]");
      if(trigger) openModal(trigger.getAttribute("data-modal"));

      const backdrop = e.target.classList && e.target.classList.contains("modal");
      if(backdrop) closeModal(e.target);

      const closeBtn = e.target.closest(".modal-close");
      if(closeBtn) closeModal(closeBtn.closest(".modal"));
    });

    document.addEventListener("keydown",(e)=>{
      if(e.key==="Escape") closeAll();

      const activeModal = modals.find(m=>m.classList.contains("show"));
      if(!activeModal) return;

      if(e.key==="Enter"){
        const clickable = document.activeElement?.closest?.(".step");
        if(clickable && clickable.dataset.modal){
          openModal(clickable.dataset.modal);
        }
      }

      if(e.key==="Tab"){
        const focusables = Array.from(activeModal.querySelectorAll('button, a, input, textarea, select, [tabindex]:not([tabindex="-1"])'))
          .filter(el=>!el.hasAttribute("disabled"));
        if(focusables.length===0) return;
        const first = focusables[0];
        const last = focusables[focusables.length-1];
        if(e.shiftKey && document.activeElement===first){ e.preventDefault(); last.focus(); }
        else if(!e.shiftKey && document.activeElement===last){ e.preventDefault(); first.focus(); }
      }
    });

    // Mode switch (Rápido / Pro)
    const tabs = Array.from(document.querySelectorAll(".tab"));
    const mapSub = document.getElementById("mapSub");
    const stepsSub = document.getElementById("stepsSub");
    const diagramCaption = document.getElementById("diagramCaption");
    const calloutMain = document.getElementById("calloutMain");
    let mode = "rapido";

    const MODE_TEXT = {
      rapido: {
        mapSub: "En 4 pasos: entender, priorizar, implementar, sostener (con mínimos).",
        stepsSub: "Abre cada paso: verás entregables sencillos y métricas mínimas.",
        caption: "partir hoy (mínimos)",
        callout: "Regla Aegis8: 80% del riesgo baja con básicos bien hechos."
      },
      pro: {
        mapSub: "Mismo ciclo, pero para equipos: roles, evidencia, ritual y continuidad.",
        stepsSub: "Abre cada paso: verás entregables + responsables + continuidad.",
        caption: "equipo + continuidad (sin burocracia)",
        callout: "Regla Aegis8: lo que no se puede sostener, se simplifica."
      }
    };

    function setMode(next){
      mode = next;
      tabs.forEach(t=>{
        const on = t.dataset.mode===next;
        t.classList.toggle("active", on);
        t.setAttribute("aria-selected", on ? "true" : "false");
      });
      mapSub.textContent = MODE_TEXT[next].mapSub;
      stepsSub.textContent = MODE_TEXT[next].stepsSub;
      diagramCaption.textContent = MODE_TEXT[next].caption;
      calloutMain.textContent = MODE_TEXT[next].callout;

      // subtle: update chips text for Pro
      document.querySelectorAll(".step .chip").forEach(ch=>{
        if(next==="pro" && ch.textContent.includes("duración")){
          ch.textContent = "duración: 60–120 min";
        } else if(next==="rapido" && ch.textContent.includes("duración")){
          ch.textContent = "duración: 30–60 min";
        }
      });
    }
    tabs.forEach(t=>t.addEventListener("click", ()=>setMode(t.dataset.mode)));

    // Checklist interactions
    const checklist = document.getElementById("checklist");
    const fill = document.getElementById("barFill");
    const pct = document.getElementById("pct");
    const nextHint = document.getElementById("nextHint");
    const reset = document.getElementById("reset");

    const items = Array.from(checklist.querySelectorAll(".chk"));
    const order = ["mfa","backups","roles","dns","endpoints"];
    const hints = {
      mfa:"Sugerencia: empieza por MFA en correo y repos.",
      backups:"Sugerencia: prueba restaurar un backup (aunque sea parcial).",
      roles:"Sugerencia: elimina cuentas compartidas y ordena roles.",
      dns:"Sugerencia: revisa DNS/TLS y redirecciones.",
      endpoints:"Sugerencia: actualizaciones + bloqueo + cifrado si aplica."
    };

    function updateProgress(){
      const done = items.filter(i=>i.classList.contains("done")).length;
      const total = items.length;
      const p = Math.round((done/total)*100);
      fill.style.width = p + "%";
      pct.textContent = p + "%";

      // next hint: first not done in order
      const next = order.find(k=>{
        const el = items.find(x=>x.dataset.key===k);
        return el && !el.classList.contains("done");
      });
      nextHint.textContent = next ? hints[next] : "¡Excelente! Ahora: ritual mensual y verificación continua.";
    }

    items.forEach(el=>{
      el.addEventListener("click", ()=>{
        el.classList.toggle("done");
        updateProgress();
      });
    });
    reset.addEventListener("click", ()=>{
      items.forEach(i=>i.classList.remove("done"));
      updateProgress();
    });
    updateProgress();
  </script>
<script>
(function(){
  const btn = document.getElementById('menuBtn');
  const panel = document.getElementById('mobilePanel');

  function setOpen(open){
    if(!btn || !panel) return;
    btn.setAttribute('aria-expanded', open ? 'true' : 'false');
    btn.classList.toggle('is-open', open);
    panel.classList.toggle('is-open', open);
  }

  function toggle(){
    const open = btn.getAttribute('aria-expanded') === 'true';
    setOpen(!open);
  }

  if(btn && panel){
    btn.setAttribute('aria-expanded','false');
    setOpen(false);

    btn.addEventListener('click', (e) => { e.preventDefault(); toggle(); });

    // Close menu when clicking a link
    panel.querySelectorAll('a').forEach(a => a.addEventListener('click', () => setOpen(false)));

    // Close when clicking outside
    document.addEventListener('click', (e) => {
      const open = btn.getAttribute('aria-expanded') === 'true';
      if(!open) return;
      const inside = panel.contains(e.target) || btn.contains(e.target);
      if(!inside) setOpen(false);
    });

    // Close on Esc
    document.addEventListener('keydown', (e) => { if(e.key === 'Escape') setOpen(false); });

    // Close when resizing to desktop
    window.addEventListener('resize', () => { if(window.innerWidth > 760) setOpen(false); });
  }

  // Active link highlight by page (and hash for the "Quiénes somos" anchor)
  const path = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
  const hash = (location.hash || '').toLowerCase();

  document.querySelectorAll('#navLinks a').forEach(a => {
    const page = (a.getAttribute('data-page') || '').toLowerCase();
    const h = (a.getAttribute('data-hash') || '').toLowerCase();
    if((page && page === path) || (h && h === hash)){
      a.classList.add('active');
    }
  });
})();
</script>

</body>
</html>
